(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["vgeneraltable"]=e():t["vgeneraltable"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fb15")}({3024:function(t,e,i){},8875:function(t,e,i){var n,r,s;(function(i,o){r=[],n=o,s="function"===typeof n?n.apply(e,r):n,void 0===s||(t.exports=s)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(p){var i,n,r,s=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,o=/@([^@]*):(\d+):(\d+)\s*$/gi,a=s.exec(p.stack)||o.exec(p.stack),l=a&&a[1]||!1,d=a&&a[2]||!1,h=document.location.href.replace(document.location.hash,""),c=document.getElementsByTagName("script");l===h&&(i=document.documentElement.outerHTML,n=new RegExp("(?:[^\\n]+?\\n){0,"+(d-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=i.replace(n,"$1").trim());for(var u=0;u<c.length;u++){if("interactive"===c[u].readyState)return c[u];if(c[u].src===l)return c[u];if(l===h&&c[u].innerHTML&&c[u].innerHTML.trim()===r)return c[u]}return null}}return t}))},b15c:function(t,e,i){"use strict";i("3024")},fb15:function(t,e,i){"use strict";if(i.r(e),"undefined"!==typeof window){var n=window.document.currentScript,r=i("8875");n=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var s=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);s&&(i.p=s[1])}var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"table-container",class:[{"table-scrollable-x":t.scrollX,"table-scrollable-y":t.scrollY,sticky:t.sticky&&t.isIos}]},[t.showHeader?i("div",{ref:"headerWrapper",staticClass:"table-header-wrapper",class:{isFixed:t.titleFixed},style:{top:t.sticky&&"number"===typeof t.headerTop?t.headerTop+"px":""}},[i("table",{ref:"tableHeader",style:{width:t.bodyWidth?t.bodyWidth+"px":""}},[i("colgroup",t._l(t.targetColumns,(function(t,e){return i("col",{key:e,attrs:{align:t.headerAlign,width:t.width}})})),0),i("thead",t._l(t.tableHeaderData,(function(e,n){return i("tr",{key:n},t._l(e,(function(e,n){return i("th",{key:n,class:[{"is-hidden":e.fixed},"is-"+e.headerAlign],attrs:{colspan:e.colspan,rowspan:e.rowspan}},[i("div",{staticClass:"cell",domProps:{innerHTML:t._s(e.label)}})])})),0)})),0)])]):t._e(),t.showHeader?i("div",{directives:[{name:"show",rawName:"v-show",value:t.titleFixed,expression:"titleFixed"}],style:{height:t.headerHeight?t.headerHeight+"px":""}}):t._e(),i("div",{ref:"bodyWrapper",staticClass:"table-body-wrapper",class:[t.scrollX?"is-scrolling-"+t.scrollPosition:"is-scrolling-none"],style:t.bodyWrapperStyle},[i("table",{ref:"tableBody",style:{width:t.bodyWidth?t.bodyWidth+"px":""}},[i("colgroup",t._l(t.targetColumns,(function(t,e){return i("col",{key:e,attrs:{align:t.align,width:t.width}})})),0),i("tbody",t._l(t.tableBodyData,(function(e,n){return i("tr",{key:n,class:{"sub-table":!!e.originData.parent}},t._l(e.data,(function(r,s){return i("td",{key:s,class:[{"is-hidden":r.fixed},"is-"+r.align],attrs:{colspan:r.colspan,rowspan:r.rowspan}},[t._t("col"+s,(function(){return[0===s&&e.originData.children&&e.originData.children.length>0?i("div",{staticClass:"cell",class:e.originData.isOpend?"is-open":"is-close",on:{click:function(i){return i.stopPropagation(),t.toggleSubTable(e,n)}}},[t._v(" "+t._s(r.value)+" "),i("b",{staticClass:"more-btn"})]):i("div",{staticClass:"cell"},[t._v(t._s(r.value))])]}),{cell:r})],2)})),0)})),0)])]),t.fixedColumns.length>0?i("div",{ref:"leftFixedWrapper",staticClass:"table-fixed-wrapper",class:{moved:"left"===t.scrollPosition},style:{width:t.fixedWrapperWidth?t.fixedWrapperWidth+"px":""}},[t.showHeader?i("div",{ref:"fixedHeaderWrapper",staticClass:"table-left-fixed-header-wrapper",class:{isFixed:t.titleFixed},style:{top:"number"===typeof t.headerTop?t.headerTop+"px":"",width:t.fixedWrapperWidth?t.fixedWrapperWidth+"px":""}},[i("table",{ref:"fixedTableHeader",style:{width:t.bodyWidth?t.bodyWidth+"px":""}},[i("colgroup",t._l(t.targetColumns,(function(t,e){return i("col",{key:e,attrs:{align:t.headerAlign,width:t.width}})})),0),i("thead",t._l(t.tableHeaderData,(function(e,n){return i("tr",{key:n},t._l(e,(function(e,n){return i("th",{key:n,class:[{"is-hidden":!e.fixed,"is-fixed-last":n==t.fixedColumns.length-1},"is-"+e.headerAlign],attrs:{colspan:e.colspan,rowspan:e.rowspan}},[i("div",{staticClass:"cell",domProps:{innerHTML:t._s(e.label)}})])})),0)})),0)])]):t._e(),t.showHeader?i("div",{directives:[{name:"show",rawName:"v-show",value:t.titleFixed,expression:"titleFixed"}],style:{height:t.headerHeight?t.headerHeight+"px":"",width:t.fixedWrapperWidth?t.fixedWrapperWidth+"px":""}}):t._e(),i("div",{ref:"fixedBodyWrapper",staticClass:"table-left-fixed-body-wrapper",style:{height:t.fixedBodyHeight?t.fixedBodyHeight+"px":""}},[i("table",{ref:"fixedTableBody",style:{width:t.bodyWidth?t.bodyWidth+"px":""}},[i("colgroup",t._l(t.targetColumns,(function(t,e){return i("col",{key:e,attrs:{align:t.align,width:t.width}})})),0),i("tbody",t._l(t.tableBodyData,(function(e,n){return i("tr",{key:n,class:{"sub-table":!!e.originData.parent}},t._l(e.data,(function(r,s){return i("td",{key:s,class:[{"is-hidden":!r.fixed,"is-fixed-last":s==t.fixedColumns.length-1},"is-"+r.align],attrs:{colspan:r.colspan,rowspan:r.rowspan}},[t._t("col"+s,(function(){return[0===s&&e.originData.children&&e.originData.children.length>0?i("div",{staticClass:"cell",class:e.originData.isOpend?"is-open":"is-close",on:{click:function(i){return i.stopPropagation(),t.toggleSubTable(e,n)}}},[t._v(" "+t._s(r.value)+" "),i("b",{staticClass:"more-btn"})]):i("div",{staticClass:"cell"},[t._v(" "+t._s(r.value)+" ")])]}),{cell:r})],2)})),0)})),0)])])]):t._e()])},a=[];const l=function(t,e=60){let i=!1;return function(...n){i||(t.apply(this,...n),i=!0,setTimeout(()=>i=!1,e))}};var d={name:"general-table",props:{tableData:{type:Array},columns:{type:Array,default:()=>[{label:"",field:"",fixed:!1,hide:!1,align:"",headerAlign:"",width:"",minWidth:"",filter:"",children:[]}]},width:[String,Number],height:[String,Number],maxHeight:[String,Number],headerTop:{type:[String,Number],default:0},showHeader:{type:Boolean,default:!0},sticky:{type:Boolean,default:!0},spanMethod:{type:Function}},data(){return{layout:{},isLeftFixed:!1,isRightFixed:!1,tableHeaderData:[],tableBodyData:[],targetColumns:[],fixedColumns:[],rightFixedColumns:[],fixedWrapperWidth:null,bodyWidth:null,bodyHeight:null,fixedBodyHeight:null,scrollX:!1,scrollY:!1,titleFixed:!1,scrollPosition:"right",baseSize:60,headerHeight:null,isIos:!1}},computed:{shouldUpdateHeight(){return this.height||this.maxHeight||this.fixedColumns.length>0||this.rightFixedColumns.length>0},bodyWrapperStyle(){const t={};return this.bodyHeight&&(this.height&&(t.height=this.bodyHeight+"px"),this.maxHeight&&(t["max-height"]=Math.max(this.bodyHeight,this.maxHeight-this.headerHeight)+"px")),t}},watch:{columns:{handler(t){console.log(t),this.createTableHeader(t),this.createTableBody(),this.$nextTick(()=>{this.doLayout()})},immediate:!0},tableData:{handler(){this.createTableBody(),this.$nextTick(()=>{this.doLayout(),this.bodyScrollFunc()})}},height:{handler(t){this.setHeight(t)},immediate:!0},maxHeight:{handler(t){this.setMaxHeight(t)},immediate:!0}},created(){const t="undefined"!==typeof window&&window.navigator.userAgent.toLowerCase();this.isIos=t&&/iphone|ipad|ipod|ios/.test(t),this.createTableHeader(this.columns)},mounted(){this.$refs.bodyWrapper.addEventListener("touchstart",this.startFunc.bind(this)),this.$refs.bodyWrapper.addEventListener("touchmove",this.moveFunc.bind(this)),this.$refs.bodyWrapper.addEventListener("touchend",this.endFunc.bind(this)),this.sticky&&!this.isIos&&window.addEventListener("scroll",this.handleScroll.bind(this)),this.updateColumnsWidth(),this.doLayout()},beforeDestroyed(){this.$refs.bodyWrapper.removeEventListener("touchstart",this.startFunc.bind(this)),this.$refs.bodyWrapper.removeEventListener("touchmove",this.moveFunc.bind(this)),this.$refs.bodyWrapper.removeEventListener("touchend",this.endFunc.bind(this)),this.sticky&&!this.isIos&&window.removeEventListener("scroll",this.handleScroll.bind(this))},methods:{startFunc(){},moveFunc:l((function(){this.bodyScrollFunc()}),17),endFunc(){setTimeout(()=>{this.bodyScrollFunc()},500)},bodyScrollFunc(){if("object"!==typeof this.$refs.bodyWrapper)return;const{scrollLeft:t,scrollTop:e}=this.$refs.bodyWrapper;this.scrollPosition=t>0?"left":"right",this.$refs.tableHeader.style.transform=`translate3d(${-t}px, 0, 0)`,this.$refs.fixedTableBody&&this.$refs.fixedTableBody.style&&(this.$refs.fixedTableBody.style.transform=`translate3d(0, ${-e}px, 0)`),"object"===typeof this.$listeners&&this.$listeners["update:position"]&&this.$emit("update:position",{left:t,top:e})},handleScroll:l((function(){if(this.isIos)return void(this.titleFixed=!1);const t=this.$el.getBoundingClientRect().top;this.titleFixed=t<=Number(this.headerTop)}),17),createTableHeader(t=[]){let e=t.filter(t=>!t.hide);e.forEach(t=>{Array.isArray(t.children)&&t.children.length>0&&(t.children=t.children.filter(t=>!t.hide))});const i=e.filter(t=>!0===t.fixed||"left"===t.fixed),n=e.filter(t=>"right"===t.fixed),r=e.filter(t=>!t.fixed);e=[].concat(i).concat(r).concat(n),this.updateColumns(e);const s=e.some(t=>Array.isArray(t.children)&&t.children.length>0),o=s?[[],[]]:[[]];for(const a of e){const t=Object.assign({headerAlign:"right",align:"right",colspan:1,rowspan:1},a);if(Array.isArray(a.children)&&a.children.length>0){t.colspan=a.children.length;const e=a.children.map(t=>Object.assign({headerAlign:"right",align:"right",colspan:1,rowspan:1},t));o[1].push(...e)}else s&&(t.rowspan=2);o[0].push(t)}this.tableHeaderData=o},updateColumns(t){this.flattenColumns=this.flatColumns(t).map(t=>{const e=Object.assign({headerAlign:"right",align:"right"},t);return e}),this.fixedColumns=this.flattenColumns.filter(t=>!0===t.fixed||"left"===t.fixed),this.rightFixedColumns=this.flattenColumns.filter(t=>"right"===t.fixed);const e=this.flattenColumns.filter(t=>!t.fixed);this.targetColumns=[].concat(this.fixedColumns).concat(e).concat(this.rightFixedColumns)},getOneData(t,e){const i={};return i.originData=t,i.data=this.targetColumns.map((i,n)=>{const{rowspan:r=1,colspan:s=1}=this.getSpan(t,i,e,n),o=Object.assign({},i);return o.row=t,o.rowspan=r,o.colspan=s,o.filter&&"function"===typeof this.$options.filters[o.filter]?o.value=this.$options.filters[o.filter](t[o.field]):o.value=t[o.field],o}),i},getSpan(t,e,i,n){let r=1,s=1;const o=this.spanMethod;if("function"===typeof o){const a=o({row:t,column:e,rowIndex:i,columnIndex:n});"object"===typeof a&&(r=a.rowspan,s=a.colspan)}return{rowspan:r,colspan:s}},flatColumns(t){const e=[];return t.forEach(t=>{t.children?e.push(...this.flatColumns(t.children)):e.push(t)}),e},flatTable(t){const e=[];return t.forEach((t,i)=>{e.push(this.getOneData(t,i)),t.isOpend&&t.children&&e.push(...this.flatTable(t.children))}),e},createTableBody(){console.log(this.tableData),this.tableBodyData=this.flatTable(this.tableData),console.log(this.tableBodyData)},toggleSubTable(t,e){if(console.log(e),t.originData.isOpend){const i=t.originData.children&&t.originData.children.length||0;this.tableBodyData.splice(e+1,i)}else{const i=t.originData.children.map((t,i)=>this.getOneData(t,e+i));this.tableBodyData.splice(e+1,0,...i)}t.originData.isOpend=!t.originData.isOpend,this.$nextTick(()=>{this.moveFunc(),this.updateElsHeight()})},doLayout(){this.shouldUpdateHeight&&this.updateElsHeight(),this.updateColumnsWidth()},updateElsHeight(){const{headerWrapper:t}=this.$refs;if(this.showHeader&&!t)return;const e=this.headerHeight=this.showHeader?t.offsetHeight:0,i=this.tableHeight=this.$el.clientHeight;null!==this.height&&(this.bodyHeight=i-e),this.fixedBodyHeight=this.bodyHeight,this.viewportHeight=i},updateColumnsWidth(){const t=this.$el.clientWidth;let e=0;const{targetColumns:i}=this,n=i.filter(t=>"number"!==typeof t.width);if(i.forEach(t=>{t.minWidth=t.minWidth||this.baseSize,"number"===typeof t.width&&(t.realWidth=t.width)}),n.length>0){if(i.forEach(t=>{e+=t.width||t.minWidth}),e<=t){this.scrollX=!1;const i=t-e;if(1===n.length)n[0].realWidth=n[0].minWidth+i;else{const t=n.reduce((t,e)=>t+e.minWidth,0),e=i/t;let r=0;n.forEach((t,i)=>{if(0===i)return;const n=Math.floor(t.minWidth*e);r+=n,t.realWidth=t.minWidth+n}),n[0].realWidth=n[0].minWidth+i-r}}else this.scrollX=!0,n.forEach(t=>{t.realWidth=t.minWidth});this.bodyWidth=Math.max(e,t)}else i.forEach(t=>{t.realWidth=t.width||t.minWidth,e+=t.realWidth}),this.scrollX=e>t,this.bodyWidth=Math.max(t,e);this.targetColumns.forEach(t=>{t.width=i.find(e=>e.field===t.field).realWidth}),this.fixedWrapperWidth=this.fixedColumns.map(t=>t.width||0).reduce((t,e)=>t+e,0)},setHeight(t,e="height"){const i=this.$el,n=this.parseHeight(t);return i||!n&&0!==n?(this.scrollY=!0,"number"===typeof n?(i.style[e]=n+"px",this.updateElsHeight()):"string"===typeof n&&(i.style[e]=n,this.updateElsHeight()),null):this.$nextTick(()=>this.setHeight(n,e))},setMaxHeight(t){this.setHeight(t,"max-height")},parseHeight(t){return"number"===typeof t?t:"string"===typeof t?/^\d+(?:px)?$/.test(t)?parseInt(t,10):t:null}}},h=d;i("b15c");function c(t,e,i,n,r,s,o,a){var l,d="function"===typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=i,d._compiled=!0),n&&(d.functional=!0),s&&(d._scopeId="data-v-"+s),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},d._ssrRegister=l):r&&(l=a?function(){r.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(d.functional){d._injectStyles=l;var h=d.render;d.render=function(t,e){return l.call(e),h(t,e)}}else{var c=d.beforeCreate;d.beforeCreate=c?[].concat(c,l):[l]}return{exports:t,options:d}}var u=c(h,o,a,!1,null,"251d9c3e",null),p=u.exports;p.install=function(t){t.component(p.name,p)};var f=p;const g=[f],y=function(t){y.installed||g.map(e=>t.component(e.name,e))};"undefined"!==typeof window&&window.Vue&&y(window.Vue);var b={install:y,generalTable:f};e["default"]=b}})}));
//# sourceMappingURL=vgeneraltable.umd.min.js.map